(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1182:function(e,t,o){"use strict";o(871)},1183:function(e,t,o){(t=o(58)(!1)).push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap);"]),t.push([e.i,"@import url(https://use.typekit.net/kej5qyk.css);"]),t.push([e.i,".CodeMirror pre{margin-bottom:0!important}.CodeMirror-fullscreen,.editor-preview-side,.editor-toolbar.fullscreen{z-index:50}",""]),e.exports=t},1210:function(e,t,o){"use strict";o.r(t);o(414),o(26),o(769),o(181),o(736),o(410),o(9),o(47);var l=o(3),r={components:{VueSimplemde:o(793).a},middleware:["authenticated"],head:function(){return{title:"New Proposal"}},data:function(){var e=window.localStorage.getItem("cached_proposal"),t=window.localStorage.getItem("cached_proposalIpfs");return e=e?JSON.parse(e):{content_hash:null,category:1,reward:0,cycle:0},{advanced:!1,success:!1,ipfsExplorer:"https://ipfs.effect.ai",loading:!1,uploadingFile:!1,selectedFile:null,preview:!1,proposalIpfs:t=t?JSON.parse(t):{version:1,title:"",body:"> You can use this template as a starting point. Make sure to include as much information about your proposal in this description\n\n### Summary\ninsert a short summary including the goal of your proposal\n\n### Proposal Details\ninsert a detailed description of your proposal and what it entails\n\n### Scope\nDescribe the scope of your proposal. Make sure to scope your proposal. If it is too big, consider multiple proposals with smaller scopes\n\n### Budget Overview\nInsert a detailed overview of your budget here:\n| Service | Description | Costs |\n| -------- | -------- | -------- |\n| Example Service 1 | Description of your example service 1 | ... EFX   |\n| Example Service 2 | Description of your example service 2 | ... EFX   |\n\n### Deliverables\nSpecify a detailed and scoped list of deliverables for this proposal\n\n### Timeline\nSpecify your timeline of the different deliverables here",files:[]},proposal:e,cachedFormData:null}},filters:{formatBytes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var o=1024,l=t<0?0:t,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,i)).toFixed(l))+" "+r[i]}},computed:{wallet:function(){return this.$wallet?this.$wallet.wallet:null},loggedIn:function(){return this.wallet&&this.wallet.auth},hasChanged:function(){return this.cachedFormData!==this.formDataForComparison()}},watch:{proposal:{deep:!0,handler:function(e){console.log("caching proposal.."),window.localStorage.setItem("cached_proposal",JSON.stringify(e))}},proposalIpfs:{deep:!0,handler:function(e){console.log("caching proposalIpfs.."),window.localStorage.setItem("cached_proposalIpfs",JSON.stringify(e))}}},created:function(){window.addEventListener("beforeunload",this.checkClose),this.cachedFormData=this.formDataForComparison()},beforeDestroy:function(){window.removeEventListener("beforeunload",this.checkClose)},beforeRouteLeave:function(e,t,o){this.checkClose()&&o()},methods:{getSelectedFile:function(){this.selectedFile=this.$refs.file.files[0]},uploadProposal:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,l,r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.proposalIpfs.body||!e.proposalIpfs.title){t.next=24;break}if(o=new Blob([JSON.stringify(e.proposalIpfs)],{type:"text/json"}),(l=new FormData).append("file",o),!(o.size>1e7)){t.next=9;break}alert("Max file size allowed is 10 MB"),e.proposal.content_hash=null,t.next=24;break;case 9:return t.prev=9,t.next=12,fetch("".concat("https://ipfs.effect.ai","/api/v0/add?pin=true"),{method:"POST",body:l});case 12:return r=t.sent,t.next=15,r.json();case 15:n=t.sent,console.log(n),e.proposal.content_hash=n.Hash,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(9),e.proposal.content_hash=null,console.log(t.t0);case 24:case"end":return t.stop()}}),t,null,[[9,20]])})))()},uploadFile:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.selectedFile){t.next=26;break}if(e.uploadingFile=!0,(o=new FormData).append("file",e.selectedFile),!(e.selectedFile.size>1e7)){t.next=10;break}alert("Max file size allowed is 10 MB"),e.selectedFile=null,e.$refs.file.value="",t.next=25;break;case 10:return t.prev=10,t.next=13,fetch("".concat("https://ipfs.effect.ai","/api/v0/add?pin=true"),{method:"POST",body:o});case 13:return l=t.sent,t.next=16,l.json();case 16:r=t.sent,e.proposalIpfs.files.push(r),e.selectedFile=null,e.$refs.file.value="",t.next=25;break;case 22:t.prev=22,t.t0=t.catch(10),console.log(t.t0);case 25:e.uploadingFile=!1;case 26:case"end":return t.stop()}}),t,null,[[10,22]])})))()},removeFile:function(e){this.proposalIpfs.files.splice(this.proposalIpfs.files.indexOf(e),1)},createProposal:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.uploadProposal();case 3:if(!e.proposal.content_hash){t.next=19;break}return o=new Date,!0,(l=[]).push({account:e.$dao.proposalConfig.proposal_cost.contract,name:"transfer",authorization:[{actor:e.wallet.auth.accountName,permission:e.wallet.auth.permission}],data:{from:e.wallet.auth.accountName,to:"daoproposals",quantity:e.$dao.proposalConfig.proposal_cost.quantity,memo:"proposal"}}),l.push({account:"daoproposals",name:"createprop",authorization:[{actor:e.wallet.auth.accountName,permission:e.wallet.auth.permission}],data:{author:e.wallet.auth.accountName,pay:[{field_0:{quantity:Number.parseFloat(e.proposal.reward).toFixed(4)+" EFX",contract:"effecttokens"},field_1:o.toISOString().slice(0,-1)}],content_hash:e.proposal.content_hash,category:parseInt(e.proposal.category),cycle:parseInt(e.proposal.cycle),msig:e.proposal.msig?e.proposal.msig:null}}),t.prev=9,t.next=12,e.$wallet.handleTransaction(l);case 12:e.success=!0,e.$modal.show({color:"success",title:"Transaction Sent",persistent:!0,text:"Your Proposal Creation Transaction was sent! It might take a couple of minutes before your proposals shows up.",cancel:!1,onConfirm:function(){e.$router.push({path:"/proposals"})}}),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(9),e.$modal.show({color:"danger",title:"Error",persistent:!0,text:t.t0});case 19:e.loading=!1;case 20:case"end":return t.stop()}}),t,null,[[9,16]])})))()},formDataForComparison:function(){return JSON.stringify({proposal:this.proposal,proposalIpfs:this.proposalIpfs})},checkClose:function(e){if(this.hasChanged&&!this.loading&&!this.success){var t="You have unsaved changes. Are you sure you wish to leave?";return!!confirm(t)||(e.preventDefault(),e.returnValue=t,!1)}return!0}}},n=(o(1182),o(25)),component=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"box"},[o("h4",{staticClass:"box-title subtitle"},[e._v("New Proposal")]),e._v(" "),o("form",{on:{submit:function(t){return t.preventDefault(),e.createProposal(t)}}},[o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Title")]),e._v(" "),o("div",{staticClass:"control"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.proposalIpfs.title,expression:"proposalIpfs.title"}],staticClass:"input",attrs:{required:"",type:"text",placeholder:"My Proposal Title"},domProps:{value:e.proposalIpfs.title},on:{input:function(t){t.target.composing||e.$set(e.proposalIpfs,"title",t.target.value)}}})])]),e._v(" "),o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Description")]),e._v(" "),o("div",{staticClass:"tabs",staticStyle:{"margin-bottom":"0"}},[o("ul",[o("li",{class:{"is-active":!e.preview}},[o("a",{on:{click:function(t){t.preventDefault(),e.preview=!1}}},[e._v("Edit")])]),e._v(" "),o("li",{class:{"is-active":e.preview}},[o("a",{on:{click:function(t){t.preventDefault(),e.preview=!0}}},[e._v("Preview")])])])]),e._v(" "),e.preview?o("div",{staticClass:"p-2"},[o("div",{staticClass:"content",domProps:{innerHTML:e._s(e.$md.render(e.proposalIpfs.body))}})]):o("div",{staticClass:"control"},[o("vue-simplemde",{ref:"markdownEditor",attrs:{required:"",configs:{promptURLs:!0,spellChecker:!1}},model:{value:e.proposalIpfs.body,callback:function(t){e.$set(e.proposalIpfs,"body",t)},expression:"proposalIpfs.body"}})],1)]),e._v(" "),o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Attachments")]),e._v(" "),o("div",{staticClass:"control"},[o("div",{staticClass:"file has-name is-fullwidth"},[o("label",{staticClass:"file-label"},[o("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"file"},on:{change:e.getSelectedFile}}),e._v(" "),e._m(0),e._v(" "),o("span",{staticClass:"file-name"},[e.selectedFile?o("span",[e._v(e._s(e.selectedFile.name))]):e._e()]),e._v(" "),o("span",[o("button",{staticClass:"button is-primary",class:{"is-loading":e.uploadingFile},attrs:{disabled:!e.selectedFile},on:{click:function(t){return t.preventDefault(),e.uploadFile(t)}}},[e._v("Upload File")])])])])]),e._v(" "),o("table",{staticClass:"table"},[e.proposalIpfs.files.length>0?o("tbody",e._l(e.proposalIpfs.files,(function(t){return o("tr",{key:t.Hash},[o("td",[o("a",{attrs:{href:e.ipfsExplorer+"/ipfs/"+t.Hash,target:"_blank"}},[e._v(e._s(t.Name))])]),e._v(" "),o("td",[e._v(e._s(e._f("formatBytes")(t.Size)))]),e._v(" "),o("td",{staticClass:"has-text-right"},[o("button",{staticClass:"button is-danger is-small",on:{click:function(o){return o.preventDefault(),e.removeFile(t)}}},[e._v("Remove")])])])})),0):o("tbody",[e._m(1)])])]),e._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Reward")]),e._v(" "),o("div",{staticClass:"control has-icons-right"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.proposal.reward,expression:"proposal.reward"}],staticClass:"input",attrs:{step:"0.0001",type:"number",min:"0",placeholder:"100"},domProps:{value:e.proposal.reward},on:{input:function(t){t.target.composing||e.$set(e.proposal,"reward",t.target.value)}}}),e._v(" "),o("span",{staticClass:"icon is-small is-right"},[e._v("\n                EFX\n              ")])])])]),e._v(" "),o("div",{staticClass:"column is-one-third"},[o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Category")]),e._v(" "),o("div",{staticClass:"control"},[o("div",{staticClass:"select",staticStyle:{width:"100%"}},[o("select",{directives:[{name:"model",rawName:"v-model",value:e.proposal.category,expression:"proposal.category"}],staticStyle:{width:"100%"},attrs:{required:""},on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.proposal,"category",t.target.multiple?o:o[0])}}},[o("option",{attrs:{disabled:""},domProps:{value:0}},[e._v("Governance")]),e._v(" "),o("option",{attrs:{hidden:""},domProps:{value:2}},[e._v("Design")]),e._v(" "),o("option",{attrs:{hidden:""},domProps:{value:3}},[e._v("Technical")]),e._v(" "),o("option",{domProps:{value:5}},[e._v("Sentiment")]),e._v(" "),o("option",{domProps:{value:6}},[e._v("Grant Request")]),e._v(" "),o("option",{domProps:{value:1}},[e._v("Marketing")]),e._v(" "),o("option",{domProps:{value:7}},[e._v("Cycle Budget")]),e._v(" "),o("option",{domProps:{value:8}},[e._v("Network Fees")]),e._v(" "),o("option",{domProps:{value:9}},[e._v("Smart Contract Updates")]),e._v(" "),o("option",{domProps:{value:4}},[e._v("Other")])])])])])])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"has-text-centered"},[o("button",{staticClass:"button is-outlined is-small",attrs:{disabled:""},on:{click:function(e){e.preventDefault()}}},[e._v("+ Add another reward")]),e._v(" "),e._m(2)]),e._v(" "),o("fieldset",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"collapsible",class:{"is-expanded":e.advanced}},[o("legend",{staticClass:"has-text-weight-bold"},[o("a",{on:{click:function(t){t.preventDefault(),e.advanced=!e.advanced}}},[e._v("Advanced")])]),e._v(" "),o("p",[e._v("These settings should not be changed unless you have in-depth knowledge of the Effect DAO internals.")]),e._v(" "),o("br"),e._v(" "),o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Cycle")]),e._v(" "),o("p",[e._v("\n            Cycle 0 indicates a draft proposal.\n            Assigning a proposal to a future cycle means the proposal becomes active when the cycle starts.\n          ")]),e._v(" "),o("div",{staticClass:"control"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.proposal.cycle,expression:"proposal.cycle"}],staticClass:"input",attrs:{required:"",type:"number",min:"0"},domProps:{value:e.proposal.cycle},on:{input:function(t){t.target.composing||e.$set(e.proposal,"cycle",t.target.value)}}})])]),e._v(" "),o("div",{staticClass:"field"},[o("label",{staticClass:"label"},[e._v("Arbitrary Transaction Proposal")]),e._v(" "),o("p",[e._v("\n            To create an ATP enter the eosio.msig name that it will execute.\n            The msig transaction must be created under your EOS account name.\n          ")]),e._v(" "),o("div",{staticClass:"control"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.proposal.msig,expression:"proposal.msig"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.proposal.msig},on:{input:function(t){t.target.composing||e.$set(e.proposal,"msig",t.target.value)}}})])])]),e._v(" "),o("div",{staticClass:"field is-grouped is-grouped-right mt-4"},[o("div",{staticClass:"control"},[o("nuxt-link",{staticClass:"button is-light",attrs:{to:"/proposals"}},[e._v("Cancel")])],1),e._v(" "),o("div",{staticClass:"control"},[o("button",{staticClass:"button is-primary is-wide",class:{"is-loading":e.loading},attrs:{type:"submit",disabled:!e.loggedIn}},[e._v("Save Proposal")]),e._v(" "),o("div",[o("small",[o("i",[e._v("Proposal Cost: "),e.$dao.proposalConfig?o("span",[e._v(e._s(e.$dao.proposalConfig.proposal_cost.quantity))]):o("span",[e._v("...")])])])])])])])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"file-cta"},[t("span",{staticClass:"file-icon"},[t("i",{staticClass:"fa fa-upload"})]),this._v(" "),t("span",{staticClass:"file-label"},[this._v("\n                  Choose a file…\n                ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("td",{attrs:{colspan:"3"}},[this._v("No files uploaded")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("small",{staticClass:"is-size-7"},[t("i",[this._v("coming soon")])])])}],!1,null,null,null);t.default=component.exports},770:function(e,t){},871:function(e,t,o){var content=o(1183);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(59).default)("2f19a8d2",content,!0,{sourceMap:!1})}}]);